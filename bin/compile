#!/usr/bin/env bash

set -e          # fail fast
set -o pipefail # do not ignore exit codes when piping output
#set -x          # enable debugging

BUILD_DIR="${1}"
CACHE_DIR="${2}"
ENV_DIR="${3}"
PLUGIN_DIR="${HOME}/.terraform.d/plugins"

BP_DIR=$(cd "$(dirname "${0}")"; cd ..; pwd)

# Load some convenience functions like status(), echo(), and indent()
source "${BP_DIR}/bin/common.sh"

mkdir -p "${PLUGIN_DIR}"

# Download terraform-provider-flynn
status "Download and install terraform-provider-flynn"
PLUGIN_URL="https://github.com/satorix/terraform-provider-flynn/releases/download/v1.0/terraform-provider-flynn"
curl "${PLUGIN_URL}" -s -L -o "${PLUGIN_DIR}/terraform-provider-flynn"
chmod +x "${PLUGIN_DIR}/terraform-provider-flynn"
